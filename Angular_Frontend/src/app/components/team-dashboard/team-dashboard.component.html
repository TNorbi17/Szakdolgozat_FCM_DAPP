<div class="team-dashboard-container">
  <h2>{{ currentUser?.name }} csapata</h2>

  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="success-message">
    {{ successMessage }}
  </div>

  <div *ngIf="teamPlayers.length > 0">
    <h3>J√°t√©kosaim</h3>
    <div class="players-list">
      <div
        *ngFor="let player of teamPlayers"
        class="player-card"
        [class.expanded]="isPlayerExpanded(player.walletAddress)"
        (click)="togglePlayerDetails(player.walletAddress)"
      >
        <div class="player-card-header">
          <strong>{{ player.name }}</strong>
          <span
            class="player-status"
            [ngClass]="{
              free: player.isFreeAgent,
              signed: !player.isFreeAgent
            }"
          >
            {{ player.isFreeAgent ? 'Szabad√∫sz√≥' : 'Igazolt' }}
          </span>
        </div>

        <div class="player-card-body">
          <p>
            <strong>Poszt:</strong>
            <span>{{ getPlayerPositionText(player.position) }}</span>
          </p>
          <p>
            <strong>√âletkor:</strong>
            <span>{{ calculateAge(player.dateOfBirth) }} √©v</span>
          </p>
          <p>
            <strong>E-mail:</strong>
            <span>{{ player.email }}</span>
          </p>
          <p>
            <strong>Wallet:</strong>
            <span class="wallet-address">{{ player.walletAddress }}</span>
          </p>

          <p
            *ngIf="
              player.contractExpires &&
              player.contractExpires.getTime() > 0
            "
          >
            <strong>Szerz≈ëd√©s lej√°rata:</strong>
            <span>
              {{ player.contractExpires | date : 'yyyy.MM.dd.' }}
              <span
                *ngIf="player.contractExpires < today"
                class="expired-label"
                >(Lej√°rt)</span
              >
            </span>
          </p>
        </div>

        <div
          class="player-actions"
          *ngIf="isPlayerExpanded(player.walletAddress)"
          (click)="$event.stopPropagation()"
        >
          
          <div class="action-section bonus-section">
            <h4>B√≥nusz ad√°sa</h4>
            <div class="input-group">
              <input
                type="number"
                [(ngModel)]="bonusAmounts[player.walletAddress]"
                placeholder="√ñsszeg (ETH)"
                min="0.001"
                step="0.001"
              />
              <input
                type="text"
                [(ngModel)]="bonusMessages[player.walletAddress]"
                placeholder="Megjegyz√©s"
              />
              <button
                class="btn btn-success"
                (click)="giveBonusToPlayer(player.walletAddress)"
              >
                B√≥nusz k√ºld√©se
              </button>
            </div>
          </div>

          <!-- B√ºntet√©s form -->
          <div class="action-section penalty-section">
            <h4>B√ºntet√©s l√©trehoz√°sa</h4>
            <div class="input-group">
              <input
                type="number"
                [(ngModel)]="penaltyAmounts[player.walletAddress]"
                placeholder="√ñsszeg (ETH)"
                min="0.001"
                step="0.001"
              />
              <input
                type="text"
                [(ngModel)]="penaltyMessages[player.walletAddress]"
                placeholder="Megjegyz√©s"
              />
              <button
                class="btn btn-warning"
                (click)="createPenaltyForPlayer(player.walletAddress)"
              >
                B√ºntet√©s l√©trehoz√°sa
              </button>
            </div>
          </div>

          
          <div class="action-section daily-payment-section">
            <h4>üìÖ Napi fizet√©s be√°ll√≠t√°sa</h4>
            <div class="input-group">
              <input
                type="number"
                [(ngModel)]="dailyAmounts[player.walletAddress]"
                placeholder="Napi ETH √∂sszeg"
                step="0.01"
                min="0"
              />
              <button
                class="btn btn-primary"
                (click)="setDailyPayment(player.walletAddress)"
              >
                Be√°ll√≠t√°s
              </button>
            </div>

            <div
              class="daily-status"
              *ngIf="dailyPaymentStates[player.walletAddress]"
            >
              <p
                *ngIf="
                  dailyPaymentStates[player.walletAddress]?.amountEth
                "
              >
                <strong>Be√°ll√≠tott napi √∂sszeg:</strong>
                {{ dailyPaymentStates[player.walletAddress].amountEth }}
                ETH
              </p>

              <p
                *ngIf="
                  dailyPaymentStates[player.walletAddress]
                    ?.lastPaymentTimestamp
                "
              >
                <strong>Utols√≥ fizet√©s:</strong>
                {{
                  dailyPaymentStates[player.walletAddress]
                    .lastPaymentTimestamp | date : 'yyyy.MM.dd. HH:mm'
                }}
                <span
                  *ngIf="
                    dailyPaymentStates[player.walletAddress]
                      .lastPaidAmount &&
                    dailyPaymentStates[player.walletAddress]
                      .lastPaidAmount! > 0
                  "
                  class="paid-amount"
                >
                  ({{
                    dailyPaymentStates[player.walletAddress]
                      .lastPaidAmount
                  }}
                  ETH)
                </span>
              </p>

              <p
                *ngIf="
                  !dailyPaymentStates[player.walletAddress]
                    ?.lastPaymentTimestamp
                "
              >
                M√©g nem t√∂rt√©nt fizet√©s.
              </p>

              <p
                *ngIf="isOverdue(player.walletAddress)"
                class="warning-message"
              >
                Napi fizet√©s ind√≠t√°s sz√ºks√©ges (14 napn√°l t√∂bb telt
                el)
              </p>
            </div>

            <button
              class="btn btn-primary"
              (click)="executeDailyPayment(player.walletAddress)"
            >
              Napi fizet√©s ind√≠t√°sa
            </button>
          </div>

         
          <div class="action-section release-section">
            <button class="btn btn-danger">J√°t√©kos elk√ºld√©se</button>
          </div>
        </div>

        
        <div class="expand-indicator" *ngIf="!isPlayerExpanded(player.walletAddress)">
          <span>‚ñº Kattints a r√©szletek√©rt</span>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="teamPlayers.length === 0 && !errorMessage">
    <p>Nincs m√©g leigazolt j√°t√©kos a csapat√°ban.</p>
    <p>
      L√°togasson el a "J√°t√©kos keres√©s" oldalra, hogy aj√°nlatot tegyen
      szabad√∫sz√≥ j√°t√©kosoknak.
    </p>
  </div>
</div>